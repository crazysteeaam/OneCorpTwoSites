# 一司两地运输可视化系统 PRD

## 1. 项目背景
本系统用于展示上飞公司大场基地与浦东基地之间的运输全流程可视化，包括地图、运输状态、物料信息、风险预警、视频追溯等，提升运输透明度与管理效率。

## 2. 主要功能

### 2.1 地图总览
- 使用高德地图 JS API，卫星+路网图层。
- 标注"上飞公司大场基地""浦东基地"真实经纬度及名称。
- 展示两基地间真实路网轨迹，区分已行驶（实线）与未行驶（虚线）段。
- 轨迹上等距显示卡车图标。
- 支持多条路线和不同策略展示。

### 2.2 一司两地概况面板
- 展示在途物料、货值、在途制品、今日在途/到达等统计数据。
- 支持日/月/年切换。

### 2.3 运输列表与详情
- 运输列表：展示所有运输任务，支持按出发时间排序与搜索。
- 运输详情卡片：展示运输编号、车牌、重量、状态、出发/到达时间、物料明细、风险等级。
- 运输进度以步骤条（Steps）展示，节点包括出库装运、扫码、关门、出卡、进卡、开门、卸货等。

### 2.4 进度追溯（图片/视频弹窗）
- 点击运输进度节点，弹窗展示该节点的图片或视频。
- 支持图片（jpg/png）和视频（mp4）自动识别。
- 弹窗全局居中，遮罩背景，支持关闭。

### 2.5 风险预警
- 页面底部左侧弹窗，展示货车风险预警信息及 AI 分析原因。
- 支持关闭与处理操作。

### 2.6 其他
- 所有弹窗、卡片均为深色半透明风格，支持响应式布局。
- 主要交互均为无刷新、即时响应。

## 3. 交互说明
- 地图与面板可同时展示，点击运输列表项切换详情。
- 运输进度节点可点击，弹出追溯图片/视频。
- 风险预警弹窗自动出现，可手动关闭。

## 4. 技术要求
- 前端框架：React + Next.js
- 地图服务：高德地图 JS API（含安全校验）
- UI 组件：Ant Design Steps、原生 CSS/模块化样式
- 代码健壮性：接口返回值健壮判断，异常友好提示

## 5. 未来可扩展
- 运输轨迹实时刷新与动画
- 物料追溯多媒体类型扩展
- 风险预警与 AI 分析联动更多业务场景

## 6. 风险预警类型与判定逻辑

### 6.1 预警类型
- **长时间停车预警**：车辆在非指定区域（如高速、路口等）长时间静止，超出设定阈值（如30分钟）自动触发。
- **延迟到货预警**：车辆未在预计到达时间内到达目的地，超出容忍时间（如15分钟）自动触发。
- **称重异常预警**：货物称重数据与系统登记重量偏差超出阈值（如±5%），自动触发。
- **货箱侵入预警**：货箱在运输途中被异常开启或检测到非授权人员靠近，自动触发。
- **其他异常状态**：如路线偏离、超速、疲劳驾驶等（可根据业务需求扩展）。

### 6.2 判定逻辑
- **长时间停车**：基于车辆GPS轨迹，若速度为0且位置无变化，持续超过设定时长则预警。
- **延迟到货**：根据计划到达时间与实际轨迹推算，若超时未到达则预警。
- **称重异常**：称重环节采集数据与订单/系统数据比对，超出阈值则预警。
- **货箱侵入**：结合货箱门磁、视频AI、红外等传感器，检测到异常开启或入侵则预警。
- **其他**：可结合AI分析、历史数据、业务规则等多维度综合判定。

> 以上预警类型和判定逻辑可根据实际业务需求进一步补充和细化。

---

> 本文档基于当前代码实现与交互撰写，后续如有新需求请补充修订。 